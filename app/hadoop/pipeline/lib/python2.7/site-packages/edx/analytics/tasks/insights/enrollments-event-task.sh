#!/bin/bash
source /edx/app/hadoop/hadoop/etc/hadoop/hadoop-env.sh
source /edx/app/hadoop/hive/conf/hive-env.sh
source /edx/app/hadoop/sqoop/conf/sqoop-env.sh


source /edx/app/hadoop/pipeline/bin/activate

intervalstart='2017-04-01'
interval=2017-04-01-$(date +%Y-%m-%d)
overwritendays='14'
nreducetask='25'
pattern='[".*tracking.log.*",".*tracking.log-([0-9]+)-([0-9]).gz.*"]'

PYTHONPATH='/edx/app/hadoop/pipeline/local/lib/python2.7/site-packages/edx/analytics/tasks/insights' \
luigi --module enrollments CourseEnrollmentEventsTask \
--source '["hdfs://localhost:9000/data/"]' \
--pattern $pattern \
--warehouse-path 'hdfs://localhost:9000/edx-analytics-pipeline/warehouse' \
--interval $interval  \
--n-reduce-task $nreducetask

