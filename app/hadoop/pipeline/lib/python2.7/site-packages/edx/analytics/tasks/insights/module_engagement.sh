#!/bin/bash
source /edx/app/hadoop/hadoop/etc/hadoop/hadoop-env.sh
source /edx/app/hadoop/hive/conf/hive-env.sh
source /edx/app/hadoop/sqoop/conf/sqoop-env.sh


source /edx/app/hadoop/pipeline/bin/activate


#list=("ModuleEngagementTableTask" "ModuleEngagementPartitionTask" "ModuleEngagementMysqlTask" " ModuleEngagementIntervalTask" "ModuleEngagementSummaryRecord" "ModuleEngagementSummaryRecordBuilder" "ModuleEngagementSummaryDataTask" "ModuleEngagementSummaryTableTask" "ModuleEngagementSummaryPartitionTask" "ModuleEngagementSummaryMetricRangeRecord" "ModuleEngagementSummaryMetricRangesDataTask" "ModuleEngagementSummaryMetricRangesTableTask" "ModuleEngagementSummaryMetricRangesPartitionTask" "ModuleEngagementSummaryMetricRangesMysqlTask" "ModuleEngagementUserSegmentRecord" "ModuleEngagementUserSegmentDataTask" "ModuleEngagementUserSegmentTableTask" "ModuleEngagementUserSegmentPartitionTask" "ModuleEngagementRosterRecord" "ModuleEngagementRosterTableTask" "ModuleEngagementRosterPartitionTask" "ModuleEngagementRosterIndexTask" "ModuleEngagementWorkflowTask" )

vardate=$(date +%Y-%m-%d)

PYTHONPATH='/edx/app/hadoop/pipeline/local/lib/python2.7/site-packages/edx/analytics/tasks/insights' \
luigi --module module_engagement ModuleEngagementWorkflowTask \
--warehouse 'hdfs://localhost:9000/edx-analytics-pipeline/warehouse/' \
--remote-log-level "DEBUG" \
--date $vardate \
--overwrite 



function moduleinterval()
{
for f in ${list[@]}
do
echo $f
PYTHONPATH='/edx/app/hadoop/pipeline/local/lib/python2.7/site-packages/edx/analytics/tasks/insights' luigi --module module_engagement $f  --warehouse 'hdfs://localhost:9000/edx-analytics-pipeline/warehouse/' --overwrite 
done
}

function moduleloop()
{
for f in ${list[@]}
do
echo $f
PYTHONPATH='/edx/app/hadoop/pipeline/local/lib/python2.7/site-packages/edx/analytics/tasks/insights' luigi --module module_engagement $f  --warehouse 'hdfs://localhost:9000/edx-analytics-pipeline/warehouse/' --overwrite 
done
}

function moduleengagementworkflow()
{
PYTHONPATH='/edx/app/hadoop/pipeline/local/lib/python2.7/site-packages/edx/analytics/tasks/insights' luigi --module module_engagement $1 --warehouse 'hdfs://localhost:9000/edx-analytics-pipeline/warehouse/' --remote-log-level "DEBUG" --date $vardate --overwrite 
}

function moduleengagementdatatask()
{
PYTHONPATH='/edx/app/hadoop/pipeline/local/lib/python2.7/site-packages/edx/analytics/tasks/insights' luigi --module module_engagement $1  --date $vardate --overwrite  --output-root 'hdfs://localhost:9000/edx-analytics-pipeline/event-export/output/'
}

function moduleroster()
{
PYTHONPATH='/edx/app/hadoop/pipeline/local/lib/python2.7/site-packages/edx/analytics/tasks/insights' luigi --module module_engagement $1  --date $vardate --overwrite 
}

#moduleengagementworkflow ModuleEngagementWorkflowTask
#moduleroster ModuleEngagementSummaryMetricRangesMysqlTask

#this connect with elasticsearch
#moduleroster ModuleEngagementRosterIndexTask

#roster
#moduleroster ModuleEngagementUserSegmentDataTask
#moduleengagementdatatask ModuleEngagementSummaryDataTask
#moduleengagementdatatask ModuleEngagementUserSegmentDataTask

#moduleinterval ModuleEngagementIntervalTask

#mapreduce errors
#moduleengagementdatatask ModuleEngagementDataTask
