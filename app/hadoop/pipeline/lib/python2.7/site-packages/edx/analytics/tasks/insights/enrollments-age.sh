#!/bin/bash
source /edx/app/hadoop/hadoop/etc/hadoop/hadoop-env.sh
source /edx/app/hadoop/hive/conf/hive-env.sh
source /edx/app/hadoop/sqoop/conf/sqoop-env.sh


source /edx/app/hadoop/pipeline/bin/activate

intervalstart=2017-04-01
currentdate=2019-04-01-$(date +%Y-%m-%d)
overwritendays=60
nreducetask=25
pattern='[".*tracking.log.*",".*tracking.log-([0-9]+)-([0-9]).gz.*"]'

PYTHONPATH='/edx/app/hadoop/pipeline/local/lib/python2.7/site-packages/edx/analytics/tasks/insights/' \
luigi --module enrollments EnrollmentByBirthYearToMysqlTask \
--interval-start '2017-04-01' \
--interval $currentdate \
--remote-log-level "DEBUG" \
--source '["hdfs://localhost:9000/data"]' \
--pattern $pattern \
--warehouse-path 'hdfs://localhost:9000/edx-analytics-pipeline/warehouse'  \
--overwrite-n-days $overwritendays \
--n-reduce-task $nreducetask \
--mapreduce-engine "hadoop" 

