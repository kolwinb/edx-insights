#!/bin/bash
source /edx/app/hadoop/hadoop/etc/hadoop/hadoop-env.sh
source /edx/app/hadoop/hive/conf/hive-env.sh
source /edx/app/hadoop/sqoop/conf/sqoop-env.sh

source /edx/app/hadoop/pipeline/bin/activate

#list=("ImportCourseEntitlementTask" "ImportStudentCourseEnrollmentTask" "ImportAuthUserTask" "ImportAuthUserProfileTask" "ImportCourseUserGroupTask" "ImportCourseUserGroupUsersTask" "ImportShoppingCartOrder" "ImportShoppingCartOrderItem" "ImportShoppingCartCertificateItem" "ImportShoppingCartPaidCourseRegistration" "ImportShoppingCartDonation" "ImportShoppingCartCourseRegistrationCodeItem" "ImportShoppingCartCoupon" "ImportShoppingCartCouponRedemption" "ImportEcommerceUser" "ImportProductCatalog" "ImportProductCatalogClass" "ImportProductCatalogAttributes" "ImportProductCatalogAttributeValues" "ImportCurrentRefundRefundLineState" "ImportCurrentOrderState" "ImportCurrentOrderLineState" "ImportCurrentOrderDiscountState" "ImportCouponVoucherIndirectionState" "ImportCouponVoucherState" "ImportEcommercePartner" "ImportCourseModeTask" "ImportGeneratedCertificatesTask" "ImportPersistentCourseGradeTask")


database='ginkgo_edxapp'
destination='hdfs://localhost:9000/edx-analytics-pipeline/warehouse/'
credentials='/edx/etc/edx-analytics-pipeline/input.json'


PYTHONPATH='/edx/app/hadoop/pipeline/local/lib/python2.7/site-packages/edx/analytics/tasks/insights' \
luigi --module database_imports ImportAuthUserTask \
--destination $destination \
--credentials $credentials \
--database $database \
--overwrite 

PYTHONPATH='/edx/app/hadoop/pipeline/local/lib/python2.7/site-packages/edx/analytics/tasks/insights' \
luigi --module database_imports ImportAuthUserProfileTask \
--destination $destination \
--credentials $credentials \
--database $database \
--overwrite 



function loop()
{
for f in ${list[@]}
do
echo $f
PYTHONPATH='/edx/app/hadoop/pipeline/local/lib/python2.7/site-packages/edx/analytics/tasks/insights' luigi --module database_imports $f  --destination $destination --credentials $credentials --database $ginkgo_edxapp --overwrite 
done
}


#1-upload hive courseenrollment data from rdmb
#after this hive classes create other statics tables
function student_enrollment()
{
PYTHONPATH='/edx/app/hadoop/pipeline/local/lib/python2.7/site-packages/edx/analytics/tasks/insights' luigi --module database_imports $1 --destination $destination --credentials $credentials --database $database --overwrite 
}

#student_enrollment ImportStudentCourseEnrollmentTask
#student_enrollment ImportAuthUserTask
#student_enrollment ImportAuthUserProfileTask
#loop
